<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="https://ik.imagekit.io/khfpxrcgz/recycle-bin%20(1).png?updatedAt=1748088726617" />
  <title>BinTrack - Smart Dustbin Monitor</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      padding: 0;
    }

    .rown,.sidebar-header{
      display: flex;
      justify-content: left; 
      margin-left: 10px;
      align-items: center;
      margin-bottom: 20px;
    }

    .rown img , .sidebar-header img{
        margin-right: 10px;  
        width: 30px;
        height: 30px;  
    }

    .rown h2{
      font-size:larger;
    }
    .sidebar-header h2{
      font-size: larger;
      font-family:Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
    }

    .sidebar {
      width: 200px;
      background-image: linear-gradient(180deg, rgb(20, 18, 56), rgb(0, 1, 32));
      color: white;
      height: 100vh;
      padding-top: 20px;
      padding-left: 10px;
      padding-right: 10px;
      position: fixed;
    }
 
    .sidebar button {
      width: 100%;
      padding: 10px;
      background: none;
      border: none;
      color: white;
      text-align: left;
      cursor: pointer;
      font-size: larger ;
      border-radius: 8px;
      font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    }

    .sidebar button:hover {
      background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.227), rgba(255, 255, 255, 0.063));
    }

    .content {
      margin-left: 220px;
      background-color: rgb(255, 255, 255);
      padding: 20px;
      flex: 1;
    }

    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 25px;
      background-color: rgba(0, 98, 255, 0.116);
      border-radius: 20px;

    }

    .dustbin-card {
      width: 150px;
      padding: 10px;
      background-color: #ffffff;
      border-radius: 10px;
      text-align: center;
    }

    .dustbin-card img {
      width: 100px;
      height: auto;
    }

    .status.filled {
      color: red;
    }

    .status.not-filled {
      color: green;
    }
    
    #table-view table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #fff;
    }

    #table-view th, #table-view td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
      font-size: 15px;
      color: #333;
    }

    #table-view th {
      background-color: #c9e4ff;
      font-weight: 600;
      color: #000000;
    }

    #table-view tr:hover {
      background-color: #f1f3f5;
    }

    #map-view {
      width: 100%;
      height: 600px;
      margin-top: 20px;
      border-radius: 12px;
      overflow: hidden;
    }

    #map {
      height: 100%;
      width: 100%;
    }


    .tab-view {
      display: none;
    }

    .tab-view.active {
      display: block;
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <div class="sidebar-header">
      <img src="https://ik.imagekit.io/khfpxrcgz/recycle-bin%20(1).png?updatedAt=1748088726617" alt="logo">
      <h2>BinTrack</h2>
    </div>
    <button onclick="showTab('grid-view')">Grid View</button>
    <button onclick="showTab('table-view')">Table View</button>
    <button onclick="showTab('map-view')">Map View</button>
    
  </div>

  <div class="content">
    <div class="rown">
      <img src="https://ik.imagekit.io/khfpxrcgz/recycle-bin%20(1).png?updatedAt=1748088726617" alt="logo">
      <h2>Smart Dustbin Monitor</h2>
    </div>

    <p style="margin-left: 18px;color: rgba(0, 0, 0, 0.659);">BinTrack helps you stay updated on bin status anytime.<br>
Cleaner cities start with smarter monitoring.</p>
    <div id="grid-view" class="tab-view active">
      <div class="grid">
        <!-- Dustbin cards -->
        <div class="dustbin-card">
          <img id="dustbin-img-001" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png" alt="Dustbin">
          <div class="dustbin-id">001</div>
          <div class="dustbin-detail" id="dustbin-status-001">Loading...</div>
        </div>
        <div class="dustbin-card">
          <img id="dustbin-img-002" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">002</div>
          <div class="dustbin-detail" id="dustbin-status-002">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img id="dustbin-img-003" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">003</div>
          <div class="dustbin-detail" id="dustbin-status-003">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img id="dustbin-img-004" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">004</div>
          <div class="dustbin-detail" id="dustbin-status-004">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img  id="dustbin-img-005" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">005</div>
          <div class="dustbin-detail" id="dustbin-status-005">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img  id="dustbin-img-006" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">006</div>
          <div class="dustbin-detail" id="dustbin-status-006">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img id="dustbin-img-007" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">007</div>
          <div class="dustbin-detail" id="dustbin-status-007">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img id="dustbin-img-008" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">008</div>
          <div class="dustbin-detail" id="dustbin-status-008">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img id="dustbin-img-009" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">009</div>
          <div class="dustbin-detail" id="dustbin-status-009">Not Filled</div>
        </div>

        <div class="dustbin-card">
          <img id="dustbin-img-010" src="https://ik.imagekit.io/khfpxrcgz/dustbin-green.png?updatedAt=1748065493153" alt="Dustbin">
          <div class="dustbin-id">010</div>
          <div class="dustbin-detail" id="dustbin-status-010">Not Filled</div>
        </div>
      </div>
    </div>

    <div id="table-view" class="tab-view">
      <table>
        <thead>
          <tr>
            <th>Dustbin No</th>
            <th>Address</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>001</td>
            <td>My Classroom</td>
            <td id="table-status-001">Loading...</td>
          </tr>
          <tr>
            <td>002</td>
            <td>Canteen</td>
            <td id="table-status-002">Loading...</td>
          </tr>
          <tr>
            <td>003</td>
            <td>Parking 1</td>
            <td id="table-status-003">Loading...</td>
          </tr>
          <tr>
            <td>004</td>
            <td>Parking 2</td>
            <td id="table-status-004">Loading...</td>
          </tr>
          <tr>
            <td>005</td>
            <td>Boys Hostel</td>
            <td id="table-status-005">Loading...</td>
          </tr>
          <tr>
            <td>006</td>
            <td>Girls Hostel</td>
            <td id="table-status-006">Loading...</td>
          </tr>
          <tr>
            <td>007</td>
            <td>Caffe</td>
            <td id="table-status-007">Loading...</td>
          </tr>
          <tr>
            <td>008</td>
            <td>A Block</td>
            <td id="table-status-008">Loading...</td>
          </tr>
          <tr>
            <td>009</td>
            <td>B block</td>
            <td id="table-status-009">Loading...</td>
          </tr>
          <tr>
            <td>010</td>
            <td>C Block</td>
            <td id="table-status-010">Loading...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div id="map-view" class="tab-view">
      <div id="map"></div>
    </div>

  </div>

<script>
  function showTab(tabId) {
      document.querySelectorAll('.tab-view').forEach(tab => {
      tab.classList.remove('active');
    });
    document.getElementById(tabId).classList.add('active');

    if (tabId === "map-view") {
        setTimeout(() => initMap(), 200); // Important
    }
  }
</script>

<!-- Firebase & Dustbin Script -->
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-database-compat.js"></script>
<script>
  const greenBin = "https://ik.imagekit.io/khfpxrcgz/dustbin-green.png";
  const redBin = "https://ik.imagekit.io/khfpxrcgz/dustbin-red.png";

  const firebaseConfig = {
    apiKey: "AIzaSyCzi2IsDsZE5WIA7KpDgS-0RFs6vxSDqDY",
    authDomain: "brave-design-417105.firebaseapp.com",
    databaseURL: "https://brave-design-417105-default-rtdb.firebaseio.com",
    projectId: "brave-design-417105",
    storageBucket: "brave-design-417105.appspot.com",
    messagingSenderId: "218139478751",
    appId: "1:218139478751:web:a8a36aeab810976906b76a"
  };

  firebase.initializeApp(firebaseConfig);
  // Using compat version only (no mixing)
  const db = firebase.database();

  let map; 
  let dustbinLocations = {}; 
  let markers = {}; 

  // For left dashboard UI (single dustbin)
  db.ref("dustbins/001/filled").on("value", (snapshot) => {
    const filled = snapshot.val();

    document.getElementById("dustbin-status-001").textContent =
      filled ? "Filled" : "Not Filled";

    document.getElementById("dustbin-img-001").src =
      filled ? redBin : greenBin;

    document.getElementById("table-status-001").textContent =
      filled ? "Filled" : "Not Filled";

    document.getElementById("table-status-001").style.color =
      filled ? "red" : "green";
  });


  // Load all dustbins (for map)
  db.ref("dustbins").on("value", (snapshot) => {
    const data = snapshot.val();

    dustbinLocations = {};

    Object.keys(data).forEach((id) => {
      dustbinLocations[id] = {
        lat: data[id].lat,
        lng: data[id].lng,
        filled: data[id].filled
      };
    });

    updateMapMarkers();
  });


  function updateMapMarkers() {
    Object.keys(dustbinLocations).forEach(id => {
      const d = dustbinLocations[id];

      // Remove existing marker
      if (markers[id]) markers[id].setMap(null);

      // Create new marker
      markers[id] = new google.maps.Marker({
        position: { lat: d.lat, lng: d.lng },
        map: map,
        title: `Dustbin ${id}`,
        icon: d.filled
          ? "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
          : "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
      });
    });
  }


  function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 11.018, lng: 76.955 },
      zoom: 16,
    });

    updateMapMarkers(); // Load markers
  }


</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBszl7IDU_I-hIJBVwSyAxrZXwpt23kyZg&callback=initMap" defer loading="async"></script>
</body>
</html>
